<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Expanded Web Dev Learning</title>
<style>
  :root{
    --brand:#2b8a3e;
    --muted:#666;
    --card:#fff;
    --bg:#f3f4f6;
  }
  *{box-sizing:border-box}
  body{font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial; margin:0; background:var(--bg); color:#111}
  header{background:var(--brand); color:#fff; padding:18px 16px; display:flex; align-items:center; justify-content:space-between; gap:12px}
  header h1{margin:0;font-size:18px}
  nav a{color:#fff; text-decoration:none; margin-left:12px; font-weight:600}
  .container{max-width:1100px;margin:18px auto;padding:0 12px}
  .card{background:var(--card); border:1px solid #e6e9ee; border-radius:10px; padding:14px; margin-bottom:14px; box-shadow:0 1px 4px rgba(12,15,20,0.04)}
  .grid{display:grid; grid-template-columns:1fr 320px; gap:14px}
  .btn{display:inline-block; background:var(--brand); color:#fff; padding:8px 12px; border-radius:8px; text-decoration:none; border:none; cursor:pointer}
  .muted{color:var(--muted)}
  .tabs{display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap}
  .tab-btn{background:#fff;border:1px solid #ddd;padding:8px 10px;border-radius:8px;cursor:pointer}
  .tab-btn.active{background:var(--brand);color:#fff;border-color:var(--brand)}
  .course{border:1px dashed #e0e6ea;padding:10px;border-radius:8px;margin-bottom:10px;background:linear-gradient(180deg,#fff,#fbfdff)}
  textarea{width:100%;height:110px;border:1px solid #ddd;border-radius:6px;padding:8px;font-family:monospace;resize:vertical}
  .output{border:1px solid #ddd;background:#fff;padding:8px;border-radius:6px;min-height:60px}
  .small{font-size:13px}
  .progress-bar{height:18px;background:#e6e6e6;border-radius:9px;overflow:hidden}
  .progress-bar > i{display:block;height:100%;background:linear-gradient(90deg,#2b8a3e,#1b6b2b);width:0%}
  .list{list-style:none;padding:0;margin:0}
  .list li{padding:6px 0;border-bottom:1px solid #f0f2f4}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  .quiz-q{margin-bottom:10px}
  .iframe-wrap{border:1px solid #ddd;border-radius:6px; overflow:hidden}
  code{background:#f6f8fa;padding:2px 6px;border-radius:4px;font-family:monospace}
  @media (max-width:980px){
    .grid{grid-template-columns:1fr}
  }
</style>
</head>
<body>

<header>
  <div style="display:flex;align-items:center;gap:12px">
    <h1>Learn Web Dev — Expanded</h1>
    <span class="muted small">(HTML / CSS / JavaScript)</span>
  </div>
  <nav>
    <a href="#" onclick="showView('home')">Home</a>
    <a href="#" onclick="showView('lessons')">Lessons</a>
    <a href="#" onclick="showView('quizzes')">Quizzes</a>
    <a href="#" onclick="showView('assignments')">Assignments</a>
    <a href="#" onclick="showView('profile')">Profile</a>
  </nav>
</header>

<div class="container">
  <!-- HOME -->
  <section id="home" class="card" style="display:block">
    <h2 style="margin-top:0">Welcome</h2>
    <p class="muted">This site auto-generates lessons, quizzes and assignments for HTML, CSS and JavaScript. Use the Lessons page to open any course, edit code and run it in the built-in code runner. Progress is saved in your browser (localStorage).</p>
    <div class="grid" style="margin-top:12px">
      <div class="card">
        <h3 style="margin:0 0 8px 0">Quick Stats</h3>
        <p class="small">Total XP: <strong id="xpTop">0</strong></p>
        <div class="progress-bar" aria-hidden><i id="xpTopBar" style="width:0%"></i></div>
        <p class="small" style="margin-top:8px">Courses completed: <span id="countCompleted">0</span></p>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px 0">Shortcuts</h3>
        <div class="controls">
          <button class="btn" onclick="showView('lessons')">Open Lessons</button>
          <button class="btn" onclick="showView('quizzes')">Take Quizzes</button>
          <button class="btn" onclick="showView('assignments')">Assignments</button>
        </div>
      </div>
    </div>
  </section>

  <!-- LESSONS -->
  <section id="lessons" class="card" style="display:none">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
      <h2 style="margin:0">Lessons</h2>
      <div>
        <label class="small muted">Filter:</label>
        <select id="filterSubject" onchange="renderLessons()">
          <option value="all">All Subjects</option>
          <option value="HTML">HTML</option>
          <option value="CSS">CSS</option>
          <option value="JS">JavaScript</option>
        </select>
      </div>
    </div>

    <div style="margin-top:12px" id="lessonsContainer"></div>
  </section>

  <!-- QUIZZES -->
  <section id="quizzes" class="card" style="display:none">
    <h2 style="margin:0 0 8px 0">Quizzes (one per lesson)</h2>
    <p class="muted small">Each quiz has 5 questions. Score 5/5 to get <code>+5 XP</code>.</p>
    <div id="quizzesContainer"></div>
  </section>

  <!-- ASSIGNMENTS -->
  <section id="assignments" class="card" style="display:none">
    <h2 style="margin:0 0 8px 0">Assignments</h2>
    <p class="muted small">There are 10 assignments per subject. Complete to earn XP. Final project is at the bottom.</p>
    <div id="assignmentsContainer"></div>
  </section>

  <!-- PROFILE -->
  <section id="profile" class="card" style="display:none">
    <h2 style="margin:0 0 8px 0">Profile</h2>
    <p>Total XP: <strong id="xpDisplay">0</strong></p>
    <div class="progress-bar"><i id="xpBar" style="width:0%"></i></div>

    <h3 style="margin-top:12px">Completed items</h3>
    <ul id="completedList" class="list"></ul>

    <h3 style="margin-top:12px">Reset progress</h3>
    <button class="btn" onclick="resetProgress()">Reset (clear localStorage)</button>
  </section>
</div>

<!-- Course modal / runner area (generated dynamically) -->
<div id="courseModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; padding:20px;">
  <div style="width:100%;max-width:1100px; background:#fff; border-radius:10px; overflow:hidden;">
    <div style="display:flex; justify-content:space-between; align-items:center; padding:12px 14px; border-bottom:1px solid #eee;">
      <div>
        <strong id="modalTitle">Course</strong>
        <div class="muted small" id="modalSubtitle"></div>
      </div>
      <div>
        <button class="btn" onclick="closeModal()">Close</button>
      </div>
    </div>

    <div style="display:grid; grid-template-columns:1fr 360px; gap:10px; padding:12px;">
      <div>
        <div style="display:flex; gap:8px; margin-bottom:8px;">
          <button class="tab-btn active" onclick="switchEditorTab(event,'htmlEditor')">HTML</button>
          <button class="tab-btn" onclick="switchEditorTab(event,'cssEditor')">CSS</button>
          <button class="tab-btn" onclick="switchEditorTab(event,'jsEditor')">JS</button>
        </div>

        <div id="htmlEditor">
          <label class="small muted">HTML</label>
          <textarea id="editorHtml"></textarea>
        </div>
        <div id="cssEditor" style="display:none">
          <label class="small muted">CSS</label>
          <textarea id="editorCss"></textarea>
        </div>
        <div id="jsEditor" style="display:none">
          <label class="small muted">JavaScript</label>
          <textarea id="editorJs"></textarea>
        </div>

        <div style="margin-top:8px; display:flex; gap:8px;">
          <button class="btn" onclick="runPreview()">Run</button>
          <button class="btn" onclick="saveCourseEdits()">Save</button>
          <button style="background:#666" onclick="markCourseDone()">Mark Complete (+1 XP)</button>
        </div>

        <div style="margin-top:12px">
          <div class="small muted">Output preview</div>
          <div class="iframe-wrap" style="height:300px; margin-top:6px;">
            <iframe id="previewFrame" style="width:100%; height:100%; border:0;"></iframe>
          </div>
        </div>
      </div>

      <div>
        <div class="card" style="padding:10px; margin-bottom:10px;">
          <h4 style="margin:0 0 6px 0">Course details</h4>
          <p id="courseDescription" class="muted small"></p>
        </div>

        <div class="card" style="padding:10px;">
          <h4 style="margin:0 0 6px 0">Quick actions</h4>
          <div style="display:flex; flex-direction:column; gap:8px;">
            <button onclick="markCourseDone()">Mark course complete (+1 XP)</button>
            <button onclick="openRelatedQuiz()">Open quiz for this lesson</button>
            <button onclick="openRelatedAssignment()">Open assignment list</button>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
/* ========== DATA GENERATION ========== */
const SUBJECTS = ['HTML','CSS','JS'];              // JS stands for JavaScript here
const LESSONS_PER_SUBJECT = 5;
const COURSES_PER_LESSON = 8;
const QUESTIONS_PER_QUIZ = 5;
const ASSIGNMENTS_PER_SUBJECT = 10;

// XP rules
const XP_PER_COURSE = 1;
const XP_PER_ASSIGNMENT = 2;
const XP_PER_FULL_QUIZ = 5;
const XP_FINAL_PROJECT = 10;

// Storage keys
const STORAGE_KEY = 'learning_site_v1';
let state = loadState();

// initialize generated content (only once)
if(!state.initialized){
  state = {
    xp:0,
    completed:[],        // list of ids
    quizzesPassed:[],    // quiz ids
    assignmentsDone:[],  // assignment ids
    coursesContent: {},  // map id -> {html,css,js,desc}
    initialized: true
  };
  generateContent();
  saveState();
}

function generateContent(){
  for(const subject of SUBJECTS){
    for(let lesson=1; lesson<=LESSONS_PER_SUBJECT; lesson++){
      for(let course=1; course<=COURSES_PER_LESSON; course++){
        let id = courseId(subject,lesson,course);
        state.coursesContent[id] = {
          html: defaultHtmlExample(subject,lesson,course),
          css: defaultCssExample(subject,lesson,course),
          js: defaultJsExample(subject,lesson,course),
          desc: `Subject: ${subject} • Lesson ${lesson} • Course ${course}. Short explanation and examples. Replace this with full content later.`
        };
      }
      // generate quiz for lesson
      let qid = quizId(subject,lesson);
      // simple generated questions — replace later with richer content if desired
      state.coursesContent[qid] = {
        quiz: generateQuiz(subject,lesson)
      };
    }

    // generate assignments per subject
    for(let a=1; a<=ASSIGNMENTS_PER_SUBJECT; a++){
      let aid = assignmentId(subject,a);
      state.coursesContent[aid] = {
        title: `${subject} Assignment ${a}`,
        desc: `Complete this ${subject} assignment number ${a}. Build something small that demonstrates the topic.`
      };
    }
  }

  // final project
  state.coursesContent['FINAL_PROJECT'] = {
    title: 'Final Creative Project',
    desc: 'Build a complete website using HTML, CSS and JavaScript. Creativity and correctness are evaluated by you.'
  };
}

// helper ids
function courseId(subject,lesson,course){ return `${subject}_L${lesson}_C${course}` }
function lessonPrefix(subject,lesson){ return `${subject}_L${lesson}` }
function quizId(subject,lesson){ return `${subject}_L${lesson}_QUIZ` }
function assignmentId(subject,num){ return `${subject}_ASSIGN_${num}` }

// default sample example code:
function defaultHtmlExample(subject,l,c){
  return `<!-- ${subject} Lesson ${l} Course ${c} -->\n<h1>${subject} Lesson ${l} - Course ${c}</h1>\n<p>Edit HTML here and click Run to preview.</p>`;
}
function defaultCssExample(subject,l,c){
  return `/* ${subject} L${l}C${c} */\nh1{ color: #2b8a3e }\np{ font-size:14px }`;
}
function defaultJsExample(subject,l,c){
  return `// ${subject} L${l}C${c}\nconsole.log("${subject} Lesson ${l} Course ${c}");`;
}

// generate simple quiz with correct answer index 1 for HTML questions etc.
function generateQuiz(subject,lesson){
  const quiz = { questions: [] };
  for(let i=1;i<=QUESTIONS_PER_QUIZ;i++){
    quiz.questions.push({
      q: `(${subject} L${lesson}) Q${i}: Example multiple-choice. Which is correct?`,
      choices: ['Wrong option','Correct option','Also wrong','Wrong again'],
      correctIndex: 1
    });
  }
  return quiz;
}

/* ========== RENDERING ========== */
function showView(id){
  document.querySelectorAll('section').forEach(s => s.style.display='none');
  document.getElementById(id).style.display='block';
  if(id==='lessons') renderLessons();
  if(id==='quizzes') renderQuizzes();
  if(id==='assignments') renderAssignments();
  if(id==='profile') renderProfile();
}

function renderLessons(){
  const container = document.getElementById('lessonsContainer');
  container.innerHTML = '';
  const filter = document.getElementById('filterSubject').value;
  for(const subject of SUBJECTS){
    if(filter !== 'all' && filter !== subject) continue;
    const subjCard = document.createElement('div');
    subjCard.className = 'card';
    const title = document.createElement('h3'); title.textContent = subject; subjCard.appendChild(title);

    for(let lesson=1; lesson<=LESSONS_PER_SUBJECT; lesson++){
      const lessonBlock = document.createElement('div');
      lessonBlock.style.marginBottom = '8px';
      const h = document.createElement('h4'); h.textContent = `Lesson ${lesson}`; h.style.margin='6px 0';
      lessonBlock.appendChild(h);

      for(let course=1; course<=COURSES_PER_LESSON; course++){
        const id = courseId(subject,lesson,course);
        const courseDiv = document.createElement('div'); courseDiv.className='course';
        const ct = document.createElement('div');
        ct.innerHTML = `<strong>${subject} L${lesson} C${course}</strong> — <span class="muted small">${state.coursesContent[id].desc}</span>`;
        courseDiv.appendChild(ct);

        const controls = document.createElement('div'); controls.style.marginTop='8px';
        const openBtn = document.createElement('button'); openBtn.className='btn'; openBtn.textContent='Open';
        openBtn.onclick = ()=>openCourse(id, subject, lesson, course);
        const doneBtn = document.createElement('button'); doneBtn.style.marginLeft='8px'; doneBtn.textContent='Mark done';
        doneBtn.onclick = ()=>markCourseById(id);
        controls.appendChild(openBtn); controls.appendChild(doneBtn);

        courseDiv.appendChild(controls);
        lessonBlock.appendChild(courseDiv);
      }
      subjCard.appendChild(lessonBlock);
    }

    container.appendChild(subjCard);
  }
}

/* Quizzes rendering: one per lesson */
function renderQuizzes(){
  const c = document.getElementById('quizzesContainer');
  c.innerHTML = '';
  for(const subject of SUBJECTS){
    const subCard = document.createElement('div'); subCard.className='card';
    const h = document.createElement('h3'); h.textContent = `${subject} Quizzes`; subCard.appendChild(h);

    for(let lesson=1; lesson<=LESSONS_PER_SUBJECT; lesson++){
      const qid = quizId(subject,lesson);
      const quiz = state.coursesContent[qid].quiz;
      const qDiv = document.createElement('div'); qDiv.className='course';
      qDiv.innerHTML = `<strong>${subject} - Lesson ${lesson} Quiz</strong><div class="muted small">Questions: ${quiz.questions.length}</div>`;
      const startBtn = document.createElement('button'); startBtn.className='btn'; startBtn.textContent='Take Quiz';
      startBtn.onclick = ()=>openQuiz(qid, subject, lesson);
      qDiv.appendChild(startBtn);
      if(state.quizzesPassed.includes(qid)){
        const done = document.createElement('div'); done.className='small muted'; done.textContent='Passed ✔';
        done.style.marginTop='8px';
        qDiv.appendChild(done);
      }
      subCard.appendChild(qDiv);
    }
    c.appendChild(subCard);
  }
}

/* Assignments rendering */
function renderAssignments(){
  const c = document.getElementById('assignmentsContainer');
  c.innerHTML = '';
  for(const subject of SUBJECTS){
    const card = document.createElement('div'); card.className='card';
    const h = document.createElement('h3'); h.textContent = `${subject} Assignments`; card.appendChild(h);

    for(let i=1;i<=ASSIGNMENTS_PER_SUBJECT;i++){
      const aid = assignmentId(subject,i);
      const item = document.createElement('div'); item.className='course';
      item.innerHTML = `<strong>${state.coursesContent[aid].title}</strong><div class="muted small">${state.coursesContent[aid].desc}</div>`;
      const btn = document.createElement('button'); btn.className='btn'; btn.textContent='Mark complete';
      btn.onclick = ()=>completeAssignment(aid);
      item.appendChild(btn);
      if(state.assignmentsDone.includes(aid)){
        const s = document.createElement('div'); s.className='small muted'; s.textContent='Done ✔'; s.style.marginTop='8px';
        item.appendChild(s);
      }
      card.appendChild(item);
    }
    c.appendChild(card);
  }
  // final project
  const finalCard = document.createElement('div'); finalCard.className='card';
  finalCard.innerHTML = `<h3>Final Project</h3><div class="muted small">${state.coursesContent['FINAL_PROJECT'].desc}</div>`;
  const fbtn = document.createElement('button'); fbtn.className='btn'; fbtn.textContent='Mark final project complete';
  fbtn.onclick = ()=>completeFinal();
  finalCard.appendChild(fbtn);
  c.appendChild(finalCard);
}

/* PROFILE */
function renderProfile(){
  document.getElementById('xpDisplay').textContent = state.xp || 0;
  const pct = Math.min(100, (state.xp / 100) * 100); // example scale: 100 XP = 100%
  document.getElementById('xpBar').style.width = pct + '%';
  document.getElementById('xpTop').textContent = state.xp || 0;
  document.getElementById('xpTopBar').style.width = pct + '%';

  const list = document.getElementById('completedList'); list.innerHTML='';
  const all = [...state.completed, ...state.quizzesPassed, ...state.assignmentsDone];
  const unique = Array.from(new Set(all));
  unique.forEach(id=>{
    const li = document.createElement('li'); li.textContent = id;
    list.appendChild(li);
  });
  document.getElementById('countCompleted').textContent = (state.completed||[]).length;
}

/* ========== MODAL / COURSE EDITOR ========== */
let currentCourseId = null;
function openCourse(id, subject, lesson, course){
  currentCourseId = id;
  const modal = document.getElementById('courseModal');
  document.getElementById('modalTitle').textContent = `${id}`;
  document.getElementById('modalSubtitle').textContent = `${subject} • Lesson ${lesson} • Course ${course}`;
  const content = state.coursesContent[id];
  document.getElementById('courseDescription').textContent = content.desc || '';
  document.getElementById('editorHtml').value = content.html || '';
  document.getElementById('editorCss').value = content.css || '';
  document.getElementById('editorJs').value = content.js || '';
  // show modal
  modal.style.display = 'flex';
  // init preview blank
  const iframe = document.getElementById('previewFrame');
  iframe.srcdoc = '<!doctype html><html><head><meta charset="utf-8"></head><body></body></html>';
}

function closeModal(){
  document.getElementById('courseModal').style.display = 'none';
  currentCourseId = null;
}

function switchEditorTab(ev, id){
  const parent = ev.target.parentElement;
  parent.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  ev.target.classList.add('active');
  document.getElementById('htmlEditor').style.display='none';
  document.getElementById('cssEditor').style.display='none';
  document.getElementById('jsEditor').style.display='none';
  document.getElementById(id).style.display='block';
}

function runPreview(){
  const html = document.getElementById('editorHtml').value || '';
  const css = document.getElementById('editorCss').value || '';
  const js = document.getElementById('editorJs').value || '';
  const src = `<!doctype html><html><head><meta charset="utf-8"><style>${css}</style></head><body>${html}\n<script>${js}<\/script></body></html>`;
  const iframe = document.getElementById('previewFrame');
  iframe.srcdoc = src;
}

function saveCourseEdits(){
  if(!currentCourseId) return;
  state.coursesContent[currentCourseId].html = document.getElementById('editorHtml').value;
  state.coursesContent[currentCourseId].css = document.getElementById('editorCss').value;
  state.coursesContent[currentCourseId].js = document.getElementById('editorJs').value;
  saveState();
  alert('Saved.');
}

function markCourseDone(){
  if(!currentCourseId) return markCourseById(null);
  markCourseById(currentCourseId);
}
function markCourseById(id){
  id = id || currentCourseId;
  if(!id) return;
  if(!state.completed.includes(id)){
    state.completed.push(id);
    state.xp = (state.xp||0) + XP_PER_COURSE;
    saveState();
    renderProfile();
    alert(`${id} marked complete. +${XP_PER_COURSE} XP`);
  } else {
    alert('Already completed.');
  }
}

/* ========== QUIZ FLOW ========== */
function openQuiz(qid, subject, lesson){
  // build a quick modal-like quiz in a new window-in-page
  const quizData = state.coursesContent[qid].quiz;
  if(!quizData) return alert('Quiz not found');
  // build dynamic form
  const html = document.createElement('div'); html.className='card';
  html.innerHTML = `<h3>${subject} - Lesson ${lesson} Quiz</h3><div id="quizForm"></div><div id="quizResult"></div>`;
  const formDiv = html.querySelector('#quizForm');
  quizData.questions.forEach((qq, idx)=>{
    const qBlock = document.createElement('div'); qBlock.className='quiz-q';
    qBlock.innerHTML = `<div><strong>Q${idx+1}:</strong> ${qq.q}</div>`;
    qq.choices.forEach((c,ci)=>{
      const r = document.createElement('div');
      r.innerHTML = `<label><input type="radio" name="q_${idx}" value="${ci}"> ${c}</label>`;
      qBlock.appendChild(r);
    });
    formDiv.appendChild(qBlock);
  });
  const submit = document.createElement('button'); submit.className='btn'; submit.textContent='Submit Quiz';
  submit.onclick = ()=>{
    let score=0;
    quizData.questions.forEach((qq,idx)=>{
      const els = html.querySelectorAll(`input[name="q_${idx}"]`);
      let selected = -1;
      els.forEach(el=>{ if(el.checked) selected = Number(el.value) });
      if(selected === qq.correctIndex) score++;
    });
    const res = html.querySelector('#quizResult');
    res.innerHTML = `<div class="muted small">Score: ${score}/${quizData.questions.length}</div>`;
    if(score === quizData.questions.length){
      // award XP only once
      if(!state.quizzesPassed.includes(qid)){
        state.quizzesPassed.push(qid);
        state.xp = (state.xp||0) + XP_PER_FULL_QUIZ;
        saveState();
        renderProfile();
        alert('Perfect! +'+XP_PER_FULL_QUIZ+' XP awarded.');
      } else {
        alert('You already passed this quiz before.');
      }
    } else {
      alert('Quiz submitted. You need full score to get XP. Try again.');
    }
  };
  formDiv.appendChild(submit);

  // show as overlay simple
  const overlay = document.createElement('div');
  overlay.style.position='fixed'; overlay.style.inset=0; overlay.style.background='rgba(0,0,0,0.5)';
  overlay.style.display='flex'; overlay.style.alignItems='center'; overlay.style.justifyContent='center'; overlay.style.padding='20px';
  const box = document.createElement('div'); box.style.maxWidth='900px'; box.style.width='100%';
  box.appendChild(html);
  const close = document.createElement('button'); close.className='btn'; close.textContent='Close';
  close.style.marginTop='8px'; close.onclick = ()=>document.body.removeChild(overlay);
  box.appendChild(close);
  overlay.appendChild(box);
  document.body.appendChild(overlay);
}

/* ========== ASSIGNMENTS FLOW ========== */
function completeAssignment(aid){
  if(!state.assignmentsDone.includes(aid)){
    state.assignmentsDone.push(aid);
    state.xp = (state.xp||0) + XP_PER_ASSIGNMENT;
    saveState();
    renderProfile();
    alert(`${aid} completed. +${XP_PER_ASSIGNMENT} XP`);
    renderAssignments();
  } else {
    alert('Assignment already completed.');
  }
}

function completeFinal(){
  if(state.assignmentsDone.includes('FINAL_PROJECT_DONE')){
    alert('Final project already completed.');
  } else {
    state.assignmentsDone.push('FINAL_PROJECT_DONE');
    state.xp = (state.xp||0) + XP_FINAL_PROJECT;
    saveState(); renderProfile();
    alert('Final project marked done. +'+XP_FINAL_PROJECT+' XP');
  }
}

/* quick nav helpers used in modal */
function openRelatedQuiz(){
  if(!currentCourseId) return;
  const parts = currentCourseId.split('_'); // e.g. HTML_L1_C2
  const subject = parts[0];
  const lesson = parts[1].replace('L','').replace('L','');
  showView('quizzes');
  setTimeout(()=>openQuiz(quizId(subject,lesson),subject,lesson),200);
}
function openRelatedAssignment(){
  showView('assignments');
}

// ========== STORAGE ==========
function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw) return JSON.parse(raw);
  }catch(e){}
  return { xp:0, completed:[], quizzesPassed:[], assignmentsDone:[], coursesContent:{}, initialized:false };
}
function saveState(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}
function resetProgress(){
  if(confirm('Reset all progress and data? This will clear localStorage for this site.')){
    localStorage.removeItem(STORAGE_KEY);
    location.reload();
  }
}

/* ========== BOOT ==========
   Render initial UI and profile.
*/
renderLessons();
renderQuizzes();
renderAssignments();
renderProfile();

/* Show home by default */
showView('home');

</script>
</body>
</html>
